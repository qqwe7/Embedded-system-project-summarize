#include "lcd.h"
#include "stdlib.h"
#include "font.h" 
#include "usart.h"	 
#include "delay.h"
#include "lcd_ex.h"
#include "pic.h"

	
//********************************************************************************
//V4.0 20211111
//1?????????????????IC?????
//2????????ST7789????IC?????
//3???????????????????
//V4.1 20211208
//???NT5510 ID??????,???????????,?????C500??C501,???????????ID(0X5510)
//V4.2 20211222
//1?????FSMC????????7789???OV2640????
//2???????NT5510 ID?????????C501???????SSD1963?????????¶À???????????ID????????????
//////////////////////////////////////////////////////////////////////////////////	 


//LCD??????????????	   
u16 POINT_COLOR=0x0000;	//??????????
u16 BACK_COLOR=0xFFFF;  //??????????
  
//????LCD???????
//????????
_lcd_dev lcddev;
	 
//ß’?????????
//regval:??????
void LCD_WR_REG(vu16 regval)
{   
	regval = regval;		//???-O2????????,???????????
	LCD->LCD_REG = regval;  //ß’???ß’?????????	 
}
//ß’LCD????
//data:?ß’????
void LCD_WR_DATA(vu16 data)
{	  
	data = data;			//???-O2????????,???????????
	LCD->LCD_RAM = data;		 
}
//??LCD????
//?????:???????
u16 LCD_RD_DATA(void)
{
	vu16 ram;			//????????
	ram = LCD->LCD_RAM;	
	return ram;	 
}					   
//ß’?????
//LCD_Reg:????????
//LCD_RegValue:?ß’???????
void LCD_WriteReg(u16 LCD_Reg,u16 LCD_RegValue)
{	
	LCD->LCD_REG = LCD_Reg;		//ß’???ß’?????????	 
	LCD->LCD_RAM = LCD_RegValue;//ß’??????	    		 
}	   
//???????
//LCD_Reg:????????
//?????:??????????
u16 LCD_ReadReg(u16 LCD_Reg)
{										   
	LCD_WR_REG(LCD_Reg);		//ß’??????????????
	delay_us(5);		  
	return LCD_RD_DATA();		//??????????
}   
//???ß’GRAM
void LCD_WriteRAM_Prepare(void)
{
 	LCD->LCD_REG = lcddev.wramcmd;	   //????ß’GRAM????
}	 
//LCDß’GRAM
//RGB_Code:????
void LCD_WriteRAM(u16 RGB_Code)
{							    
	LCD->LCD_RAM = RGB_Code;//ß’16¶ÀGRAM
}


//?????????????	 
//x,y:????
//?????:???????
u16 LCD_ReadPoint(u16 x,u16 y)
{
 	u16 r=0,g=0,b=0;
	if(x>=lcddev.width||y>=lcddev.height)return 0;	//???????¶∂,??????		   
	LCD_SetCursor(x,y);
    if (lcddev.id == 0X5510)    //5510 ?????GRAM???
    {
        LCD_WR_REG(0X2E00);
    }
    else                        //????IC(9341/5310/1963/7789)?????GRAM???
    {
        LCD_WR_REG(0X2E);
    }
 	r=LCD_RD_DATA();								//dummy Read	   
    if (lcddev.id == 0X1963)    //??1963???,?????
    {
        return r;               //1963?????????
    }
    r = LCD_RD_DATA();          //??????????

    //9341/5310/5510/7789 ???2?¶∆???
    b = LCD_RD_DATA();
    g = r & 0XFF;               //???? 9341/5310/5510/7789, ????¶∆??????RG???,R???,G???,???8¶À
    g <<= 8;
    return (((r >> 11) << 11) | ((g >> 10) << 5) | (b >> 11));  // 9341/5310/5510/7789 ????????????
}			 

//LCD???????
void LCD_DisplayOn(void)
{					   
    if (lcddev.id == 0X5510)    //5510??????????
    {
        LCD_WR_REG(0X2900);     //???????
    }
    else                        //9341/5310/1963/7789 ??????????????
    {
        LCD_WR_REG(0X29);       //???????
    }
}
//LCD??????
void LCD_DisplayOff(void)
{	   
    if (lcddev.id == 0X5510)    //5510?????????
    {
        LCD_WR_REG(0X2800);     //??????
    }
    else                        //9341/5310/1963/7789 ?????????????
    {
        LCD_WR_REG(0X28);       //??????
    }
}
//???®¥?????¶À??
//Xpos:??????
//Ypos:??????
void LCD_SetCursor(u16 Xpos, u16 Ypos)
{
    if (lcddev.id == 0X1963)
    {
        if (lcddev.dir == 0)   //x????????»Œ
        {
            Xpos = lcddev.width - 1 - Xpos;
            LCD_WR_REG(lcddev.setxcmd);
            LCD_WR_DATA(0);
            LCD_WR_DATA(0);
            LCD_WR_DATA(Xpos >> 8);
            LCD_WR_DATA(Xpos & 0XFF);
        }
        else
        {
            LCD_WR_REG(lcddev.setxcmd);
            LCD_WR_DATA(Xpos >> 8);
            LCD_WR_DATA(Xpos & 0XFF);
            LCD_WR_DATA((lcddev.width - 1) >> 8);
            LCD_WR_DATA((lcddev.width - 1) & 0XFF);
        }

        LCD_WR_REG(lcddev.setycmd);
        LCD_WR_DATA(Ypos >> 8);
        LCD_WR_DATA(Ypos & 0XFF);
        LCD_WR_DATA((lcddev.height - 1) >> 8);
        LCD_WR_DATA((lcddev.height - 1) & 0XFF);

    }
    else if (lcddev.id == 0X5510)
    {
        LCD_WR_REG(lcddev.setxcmd);
        LCD_WR_DATA(Xpos >> 8);
        LCD_WR_REG(lcddev.setxcmd + 1);
        LCD_WR_DATA(Xpos & 0XFF);
        LCD_WR_REG(lcddev.setycmd);
        LCD_WR_DATA(Ypos >> 8);
        LCD_WR_REG(lcddev.setycmd + 1);
        LCD_WR_DATA(Ypos & 0XFF);
    }
    else     //9341/5310/7789??????????
    {
        LCD_WR_REG(lcddev.setxcmd);
        LCD_WR_DATA(Xpos >> 8);
        LCD_WR_DATA(Xpos & 0XFF);
        LCD_WR_REG(lcddev.setycmd);
        LCD_WR_DATA(Ypos >> 8);
        LCD_WR_DATA(Ypos & 0XFF);
    }
}

/******************************************************************************
      ????????????????????????
      ????????x1,x2 ?????ß÷????????????
                y1,y2 ?????ß÷????????????
      ???????  ??
******************************************************************************/
void LCD_Address_Set(u16 x1,u16 y1,u16 x2,u16 y2)
{
	if (lcddev.id == 0X5510)             //5510,?ß÷????????????:0x2A00??0x2A03???ß÷????????????:0x2B00??0x2B03
    {
        LCD_WR_REG(lcddev.setxcmd);      //?ß÷???????????:0x2A00
        LCD_WR_DATA(x1 >> 8);            //????????????SC??8¶À
        LCD_WR_REG(lcddev.setxcmd + 1);  //?ß÷???????????:0x2A01
        LCD_WR_DATA(x1 & 0XFF);          //????????????SC??8¶À
		LCD_WR_REG(lcddev.setxcmd + 2);  //?ß÷???????????:0x2A02
        LCD_WR_DATA(x2 >> 8);            //?????ßﬂ??????EC??8¶À
        LCD_WR_REG(lcddev.setxcmd + 3);  //?ß÷???????????:0x2A03
        LCD_WR_DATA(x2 & 0XFF);          //?????ßﬂ??????EC??8¶À
        LCD_WR_REG(lcddev.setycmd);      //?ß÷???????????:0x2B00
        LCD_WR_DATA(y1 >> 8);            //????????????SP??8¶À
        LCD_WR_REG(lcddev.setycmd + 1);  //?ß÷???????????:0x2B01
        LCD_WR_DATA(y1 & 0XFF);          //????????????SP??8¶À
		LCD_WR_REG(lcddev.setycmd + 2);  //?ß÷???????????:0x2B02
        LCD_WR_DATA(y2 >> 8);            //?????ßﬂ??????EP??8¶À
        LCD_WR_REG(lcddev.setycmd + 3);  //?ß÷???????????:0x2B03
        LCD_WR_DATA(y2 & 0XFF);          //?????ßﬂ??????EP??8¶À
		LCD_WR_REG(lcddev.wramcmd);//??????ß’

    }
	else
	{
		LCD_WR_REG(lcddev.setxcmd);//?ß÷??????
		LCD_WR_DATA(x1 >> 8);
		LCD_WR_DATA(x1 & 0xff);
		LCD_WR_DATA(x2 >> 8);
		LCD_WR_DATA(x2 & 0xff);
		LCD_WR_REG(lcddev.setycmd);//?ß÷??????
		LCD_WR_DATA(y1 >> 8);
		LCD_WR_DATA(y1 & 0xff);
		LCD_WR_DATA(y2 >> 8);
		LCD_WR_DATA(y2 & 0xff);
		LCD_WR_REG(0x2c);//??????ß’
	}
}

//????LCD???????ı’??
//dir:0~7,????8??????(???éG???lcd.h)
//9341/5310/5510/1963/7789??IC?????????
//???:?????????????????????????????(??????9341),
//????,????????L2R_U2D????,??????????????ı’?,????????????????.
 	   
void LCD_Scan_Dir(u8 dir)
{
	u16 regval=0;
	u16 dirreg=0;
	u16 temp;  
    //?????????1963???????ı’??, ????IC?????ı’???????1963?????, ????IC???????ı’??
    if ((lcddev.dir == 1 && lcddev.id != 0X1963) || (lcddev.dir == 0 && lcddev.id == 0X1963))
    {
        switch (dir)   //???????
        {
            case 0:
                dir = 6;
                break;

            case 1:
                dir = 7;
                break;

            case 2:
                dir = 4;
                break;

            case 3:
                dir = 5;
                break;

            case 4:
                dir = 1;
                break;

            case 5:
                dir = 0;
                break;

            case 6:
                dir = 3;
                break;

            case 7:
                dir = 2;
                break;
        }
    }

    switch (dir)
    {
        case L2R_U2D://??????,???????
            regval |= (0 << 7) | (0 << 6) | (0 << 5);
            break;

        case L2R_D2U://??????,???????
            regval |= (1 << 7) | (0 << 6) | (0 << 5);
            break;

        case R2L_U2D://???????,???????
            regval |= (0 << 7) | (1 << 6) | (0 << 5);
            break;

        case R2L_D2U://???????,???????
            regval |= (1 << 7) | (1 << 6) | (0 << 5);
            break;

        case U2D_L2R://???????,??????
            regval |= (0 << 7) | (0 << 6) | (1 << 5);
            break;

        case U2D_R2L://???????,???????
            regval |= (0 << 7) | (1 << 6) | (1 << 5);
            break;

        case D2U_L2R://???????,??????
            regval |= (1 << 7) | (0 << 6) | (1 << 5);
            break;

        case D2U_R2L://???????,???????
            regval |= (1 << 7) | (1 << 6) | (1 << 5);
            break;
    }

    if (lcddev.id == 0X5510)dirreg = 0X3600;
    else dirreg = 0X36;

    if (lcddev.id == 0X9341 || lcddev.id == 0X7789)   //9341 & 7789 ?????BGR¶À
    {
        regval |= 0X08;
    }

    LCD_WriteReg(dirreg, regval);

    if (lcddev.id != 0X1963)   //1963??????????
    {
        if (regval & 0X20)
        {
            if (lcddev.width < lcddev.height)   //????X,Y
            {
                temp = lcddev.width;
                lcddev.width = lcddev.height;
                lcddev.height = temp;
            }
        }
        else
        {
            if (lcddev.width > lcddev.height)   //????X,Y
            {
                temp = lcddev.width;
                lcddev.width = lcddev.height;
                lcddev.height = temp;
            }
        }
    }

    //???????????(????)??ß≥
    if (lcddev.id == 0X5510)
    {
        LCD_WR_REG(lcddev.setxcmd);
        LCD_WR_DATA(0);
        LCD_WR_REG(lcddev.setxcmd + 1);
        LCD_WR_DATA(0);
        LCD_WR_REG(lcddev.setxcmd + 2);
        LCD_WR_DATA((lcddev.width - 1) >> 8);
        LCD_WR_REG(lcddev.setxcmd + 3);
        LCD_WR_DATA((lcddev.width - 1) & 0XFF);
        LCD_WR_REG(lcddev.setycmd);
        LCD_WR_DATA(0);
        LCD_WR_REG(lcddev.setycmd + 1);
        LCD_WR_DATA(0);
        LCD_WR_REG(lcddev.setycmd + 2);
        LCD_WR_DATA((lcddev.height - 1) >> 8);
        LCD_WR_REG(lcddev.setycmd + 3);
        LCD_WR_DATA((lcddev.height - 1) & 0XFF);
    }
    else
    {
        LCD_WR_REG(lcddev.setxcmd);
        LCD_WR_DATA(0);
        LCD_WR_DATA(0);
        LCD_WR_DATA((lcddev.width - 1) >> 8);
        LCD_WR_DATA((lcddev.width - 1) & 0XFF);
        LCD_WR_REG(lcddev.setycmd);
        LCD_WR_DATA(0);
        LCD_WR_DATA(0);
        LCD_WR_DATA((lcddev.height - 1) >> 8);
        LCD_WR_DATA((lcddev.height - 1) & 0XFF);
    }
}

//????
//x,y:????
//POINT_COLOR:???????
void LCD_DrawPoint(u16 x,u16 y)
{
	LCD_SetCursor(x,y);		//???®¥??¶À?? 
	LCD_WriteRAM_Prepare();	//???ß’??GRAM
	LCD->LCD_RAM=POINT_COLOR; 
}
//???????
//x,y:????
//color:???
void LCD_Fast_DrawPoint(u16 x,u16 y,u16 color)
{	   
 if (lcddev.id == 0X5510)
    {
        LCD_WR_REG(lcddev.setxcmd);
        LCD_WR_DATA(x >> 8);
        LCD_WR_REG(lcddev.setxcmd + 1);
        LCD_WR_DATA(x & 0XFF);
        LCD_WR_REG(lcddev.setycmd);
        LCD_WR_DATA(y >> 8);
        LCD_WR_REG(lcddev.setycmd + 1);
        LCD_WR_DATA(y & 0XFF);
    }
    else if (lcddev.id == 0X1963)
    {
        if (lcddev.dir == 0)x = lcddev.width - 1 - x;

        LCD_WR_REG(lcddev.setxcmd);
        LCD_WR_DATA(x >> 8);
        LCD_WR_DATA(x & 0XFF);
        LCD_WR_DATA(x >> 8);
        LCD_WR_DATA(x & 0XFF);
        LCD_WR_REG(lcddev.setycmd);
        LCD_WR_DATA(y >> 8);
        LCD_WR_DATA(y & 0XFF);
        LCD_WR_DATA(y >> 8);
        LCD_WR_DATA(y & 0XFF);
    }
    else     //9341/5310/7789??????????
    {
        LCD_WR_REG(lcddev.setxcmd);
        LCD_WR_DATA(x >> 8);
        LCD_WR_DATA(x & 0XFF);
        LCD_WR_REG(lcddev.setycmd);
        LCD_WR_DATA(y >> 8);
        LCD_WR_DATA(y & 0XFF);
    }

    LCD->LCD_REG=lcddev.wramcmd; 
    LCD->LCD_RAM=color; 
}

//SSD1963 ????????
//pwm:??????,0~100.??????.
void LCD_SSD_BackLightSet(u8 pwm)
{	
	LCD_WR_REG(0xBE);	//????PWM???
	LCD_WR_DATA(0x05);	//1????PWM???
	LCD_WR_DATA(pwm*2.55);//2????PWM????
	LCD_WR_DATA(0x01);	//3????C
	LCD_WR_DATA(0xFF);	//4????D
	LCD_WR_DATA(0x00);	//5????E
	LCD_WR_DATA(0x00);	//6????F
}

//????LCD???????
//dir:0,??????1,????
void LCD_Display_Dir(u8 dir)
{
    lcddev.dir = dir;       //????/????

    if (dir == 0)           //????
    {
        lcddev.width = 240;
        lcddev.height = 320;

        if (lcddev.id == 0x5510)
        {
            lcddev.wramcmd = 0X2C00;
            lcddev.setxcmd = 0X2A00;
            lcddev.setycmd = 0X2B00;
            lcddev.width = 480;
            lcddev.height = 800;
        }
        else if (lcddev.id == 0X1963)
        {
            lcddev.wramcmd = 0X2C;  //????ß’??GRAM?????
            lcddev.setxcmd = 0X2B;  //????ß’X???????
            lcddev.setycmd = 0X2A;  //????ß’Y???????
            lcddev.width = 480;     //???????480
            lcddev.height = 800;    //??????800
        }
        else                        //????IC, ????: 9341 / 5310 / 7789??IC
        {
            lcddev.wramcmd = 0X2C;
            lcddev.setxcmd = 0X2A;
            lcddev.setycmd = 0X2B;
        }

        if (lcddev.id == 0X5310)    //?????5310 ?????? 320*480?????
        {
            lcddev.width = 320;
            lcddev.height = 480;
        }
    }
    else     //????
    {
        lcddev.width = 320;
        lcddev.height = 240;

        if (lcddev.id == 0x5510)
        {
            lcddev.wramcmd = 0X2C00;
            lcddev.setxcmd = 0X2A00;
            lcddev.setycmd = 0X2B00;
            lcddev.width = 800;
            lcddev.height = 480;
        }
        else if (lcddev.id == 0X1963)
        {
            lcddev.wramcmd = 0X2C;  //????ß’??GRAM?????
            lcddev.setxcmd = 0X2A;  //????ß’X???????
            lcddev.setycmd = 0X2B;  //????ß’Y???????
            lcddev.width = 800;     //???????800
            lcddev.height = 480;    //??????480
        }
        else                        //????IC, ????: 9341 / 5310 / 7789??IC
        {
            lcddev.wramcmd = 0X2C;
            lcddev.setxcmd = 0X2A;
            lcddev.setycmd = 0X2B;
        }

        if (lcddev.id == 0X5310)    //?????5310 ?????? 320*480?????
        {
            lcddev.width = 480;
            lcddev.height = 320;
        }
    }

    LCD_Scan_Dir(DFT_SCAN_DIR);     //?????ı’??
}

//???????,?????????????????????????(sx,sy).
//sx,sy:???????????(?????)
//width,height:??????????,???????0!!
//?????ß≥:width*height.
void LCD_Set_Window(u16 sx, u16 sy, u16 width, u16 height)
{
    u16 twidth, theight;
    twidth = sx + width - 1;
    theight = sy + height - 1;

    if (lcddev.id == 0X1963 && lcddev.dir != 1)     //1963??????????
    {
        sx = lcddev.width - width - sx;
        height = sy + height - 1;
        LCD_WR_REG(lcddev.setxcmd);
        LCD_WR_DATA(sx >> 8);
        LCD_WR_DATA(sx & 0XFF);
        LCD_WR_DATA((sx + width - 1) >> 8);
        LCD_WR_DATA((sx + width - 1) & 0XFF);
        LCD_WR_REG(lcddev.setycmd);
        LCD_WR_DATA(sy >> 8);
        LCD_WR_DATA(sy & 0XFF);
        LCD_WR_DATA(height >> 8);
        LCD_WR_DATA(height & 0XFF);
    }
    else if (lcddev.id == 0X5510)
    {
        LCD_WR_REG(lcddev.setxcmd);
        LCD_WR_DATA(sx >> 8);
        LCD_WR_REG(lcddev.setxcmd + 1);
        LCD_WR_DATA(sx & 0XFF);
        LCD_WR_REG(lcddev.setxcmd + 2);
        LCD_WR_DATA(twidth >> 8);
        LCD_WR_REG(lcddev.setxcmd + 3);
        LCD_WR_DATA(twidth & 0XFF);
        LCD_WR_REG(lcddev.setycmd);
        LCD_WR_DATA(sy >> 8);
        LCD_WR_REG(lcddev.setycmd + 1);
        LCD_WR_DATA(sy & 0XFF);
        LCD_WR_REG(lcddev.setycmd + 2);
        LCD_WR_DATA(theight >> 8);
        LCD_WR_REG(lcddev.setycmd + 3);
        LCD_WR_DATA(theight & 0XFF);
    }
    else     //9341/5310/7789/1963???? ?? ???????
    {
        LCD_WR_REG(lcddev.setxcmd);
        LCD_WR_DATA(sx >> 8);
        LCD_WR_DATA(sx & 0XFF);
        LCD_WR_DATA(twidth >> 8);
        LCD_WR_DATA(twidth & 0XFF);
        LCD_WR_REG(lcddev.setycmd);
        LCD_WR_DATA(sy >> 8);
        LCD_WR_DATA(sy & 0XFF);
        LCD_WR_DATA(theight >> 8);
        LCD_WR_DATA(theight & 0XFF);
    }
}

//?????lcd
//?®Æ????????????????????ILI93XX???,?????????????????ILI9320??!!!
//??????????????ß‡?????ß”???! 
void LCD_Init(void)
{ 	
	vu32 i=0;
	
	GPIO_InitTypeDef  GPIO_InitStructure;
	FSMC_NORSRAMInitTypeDef  FSMC_NORSRAMInitStructure;
	FSMC_NORSRAMTimingInitTypeDef  readWriteTiming; 
	FSMC_NORSRAMTimingInitTypeDef  writeTiming;
    
    //# GPIOD??GPIOE??GPIOF??GPIOG??FSMC??????
	RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOB|RCC_AHB1Periph_GPIOD|RCC_AHB1Periph_GPIOE|RCC_AHB1Periph_GPIOF|RCC_AHB1Periph_GPIOG, ENABLE);//???PD,PE,PF,PG???  
	RCC_AHB3PeriphClockCmd(RCC_AHB3Periph_FSMC, ENABLE);//???FSMC???  

    //# GPIOB?????????
	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_15;//PB15 ???????,???????
	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_OUT;//????????
	GPIO_InitStructure.GPIO_OType = GPIO_OType_PP;//???????
	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;//100MHz
	GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_DOWN;//????
	GPIO_Init(GPIOB, &GPIO_InitStructure);//????? //PB15 ???????,???????

    //# GPIOD?????????
	GPIO_InitStructure.GPIO_Pin = (3<<0)|(3<<4)|(7<<8)|(3<<14);//PD0,1,4,5,8,9,10,14,15 AF OUT
	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF;//???????
	GPIO_InitStructure.GPIO_OType = GPIO_OType_PP;//???????
	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_100MHz;//100MHz
	GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_UP;//????
	GPIO_Init(GPIOD, &GPIO_InitStructure);//?????  

    //# GPIOE?????????
	GPIO_InitStructure.GPIO_Pin = (0X1FF<<7);//PE7~15,AF OUT
	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF;//???????
	GPIO_InitStructure.GPIO_OType = GPIO_OType_PP;//???????
	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_100MHz;//100MHz
	GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_UP;//????
	GPIO_Init(GPIOE, &GPIO_InitStructure);//?????  

    //# GPIOF?????????
	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_12;//PF12,FSMC_A6
	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF;//???????
	GPIO_InitStructure.GPIO_OType = GPIO_OType_PP;//???????
	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_100MHz;//100MHz
	GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_UP;//????
	GPIO_Init(GPIOF, &GPIO_InitStructure);//?????  

    //# GPIOG?????????
	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_12;//PG12,FSMC_NE4????
	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF;//???????
	GPIO_InitStructure.GPIO_OType = GPIO_OType_PP;//???????
	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_100MHz;//100MHz
	GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_UP;//????
	GPIO_Init(GPIOG, &GPIO_InitStructure);//????? 

    //# GPIOD?????GPIO_AF_FSMC
	GPIO_PinAFConfig(GPIOD,GPIO_PinSource0,GPIO_AF_FSMC);//FSMC_D2,AF12
	GPIO_PinAFConfig(GPIOD,GPIO_PinSource1,GPIO_AF_FSMC);//FSMC_D3,AF12
	GPIO_PinAFConfig(GPIOD,GPIO_PinSource4,GPIO_AF_FSMC);//FSMC_NOE,AF12
	GPIO_PinAFConfig(GPIOD,GPIO_PinSource5,GPIO_AF_FSMC);//FSMC_NWE,AF12 
	GPIO_PinAFConfig(GPIOD,GPIO_PinSource8,GPIO_AF_FSMC);//FSMC_D13,AF12 
	GPIO_PinAFConfig(GPIOD,GPIO_PinSource9,GPIO_AF_FSMC);//FSMC_D14,AF12
	GPIO_PinAFConfig(GPIOD,GPIO_PinSource10,GPIO_AF_FSMC);//FSMC_D15,AF12
	GPIO_PinAFConfig(GPIOD,GPIO_PinSource14,GPIO_AF_FSMC);//FSMC_D0,AF12
	GPIO_PinAFConfig(GPIOD,GPIO_PinSource15,GPIO_AF_FSMC);//FSMC_D1,AF12

    //# GPIOE?????GPIO_AF_FSMC
	GPIO_PinAFConfig(GPIOE,GPIO_PinSource7,GPIO_AF_FSMC);//FSMC_D4,AF12
	GPIO_PinAFConfig(GPIOE,GPIO_PinSource8,GPIO_AF_FSMC);//FSMC_D5,AF12
	GPIO_PinAFConfig(GPIOE,GPIO_PinSource9,GPIO_AF_FSMC);//FSMC_D6,AF12
	GPIO_PinAFConfig(GPIOE,GPIO_PinSource10,GPIO_AF_FSMC);//FSMC_D7,AF12
	GPIO_PinAFConfig(GPIOE,GPIO_PinSource11,GPIO_AF_FSMC);//FSMC_D8,AF12
	GPIO_PinAFConfig(GPIOE,GPIO_PinSource12,GPIO_AF_FSMC);//FSMC_D9,AF12
	GPIO_PinAFConfig(GPIOE,GPIO_PinSource13,GPIO_AF_FSMC);//FSMC_D10,AF12
	GPIO_PinAFConfig(GPIOE,GPIO_PinSource14,GPIO_AF_FSMC);//FSMC_D11,AF12
	GPIO_PinAFConfig(GPIOE,GPIO_PinSource15,GPIO_AF_FSMC);//FSMC_D12,AF12

    //# GPIOF?????GPIO_AF_FSMC
	GPIO_PinAFConfig(GPIOF,GPIO_PinSource12,GPIO_AF_FSMC);//FSMC_A6,AF12
    
    //# GPIOG?????GPIO_AF_FSMC
	GPIO_PinAFConfig(GPIOG,GPIO_PinSource12,GPIO_AF_FSMC);//FSMC_NE4,AF12

    //# FSMC?????????
	readWriteTiming.FSMC_AddressSetupTime = 0XF;	 //??????????ADDSET???16??HCLK 1/168M=6ns*16=96ns	
	readWriteTiming.FSMC_AddressHoldTime = 0x00;	 //??????????ADDHLD????A¶ƒ???	
	readWriteTiming.FSMC_DataSetupTime = 60;	     //???????????60??HCLK	=6*60=360ns
	readWriteTiming.FSMC_BusTurnAroundDuration = 0x00;   //????????????????A¶ƒ??????®∞??????????°§NOR Flash
	readWriteTiming.FSMC_CLKDivision = 0x00;             //????CLK?????????????????HCLK?????????????NOR Flash??SRAM??ROM??????????®∞?????
	readWriteTiming.FSMC_DataLatency = 0x00;             //???????????????????????úM????????????????®∞??????????????????????????
                                                         //- ??CRAM??????°¿????????0
                                                         //- ????NOR??SRAM??ROM???????????
                                                         //- ???????????????NOR?????ßµ????????????0??0xF???
	readWriteTiming.FSMC_AccessMode = FSMC_AccessMode_A;	 //?????????????????A 
    
    //# FSMCß’???????
	writeTiming.FSMC_AddressSetupTime =9;	    //??????????ADDSET???9??HCLK 6ns*9=54ns 
	writeTiming.FSMC_AddressHoldTime = 0x00;	//??????????ADDHLD????A¶ƒ???		
	writeTiming.FSMC_DataSetupTime = 8;		    //???????????6ns*9??HCLK=54ns
	writeTiming.FSMC_BusTurnAroundDuration = 0x00;
	writeTiming.FSMC_CLKDivision = 0x00;
	writeTiming.FSMC_DataLatency = 0x00;
	writeTiming.FSMC_AccessMode = FSMC_AccessMode_A;	 //?????????????????A  

    //# ?????FSMC
	FSMC_NORSRAMInitStructure.FSMC_Bank = FSMC_Bank1_NORSRAM4;                    // ???Bank1???4????FSMC_NE4????????????????BTCR[6],[7]??
	FSMC_NORSRAMInitStructure.FSMC_DataAddressMux = FSMC_DataAddressMux_Disable;  // ??????????????????????????????®¢???????????????????
	FSMC_NORSRAMInitStructure.FSMC_MemoryType =FSMC_MemoryType_SRAM;              // ?õ•??????????FSMC_MemoryType_SRAM   
	FSMC_NORSRAMInitStructure.FSMC_MemoryDataWidth = FSMC_MemoryDataWidth_16b;    //?õ•??????????16bit   
	FSMC_NORSRAMInitStructure.FSMC_BurstAccessMode =FSMC_BurstAccessMode_Disable; //??????????????????????????????????????ßπ?????FSMC_BurstAccessMode_Disable; 
	FSMC_NORSRAMInitStructure.FSMC_WaitSignalPolarity = FSMC_WaitSignalPolarity_Low;   //??????????????????????????????????????????????õ•?????ßπ??
	FSMC_NORSRAMInitStructure.FSMC_AsynchronousWait=FSMC_AsynchronousWait_Disable;  //??????????????????????,????????????ßπ,??????????
	FSMC_NORSRAMInitStructure.FSMC_WrapMode = FSMC_WrapMode_Disable;     //????????????????????????????????????????????????ßπ????????????
	FSMC_NORSRAMInitStructure.FSMC_WaitSignalActive = FSMC_WaitSignalActive_BeforeWaitState;  //???????????????????????,??????????????????????????????????????????????ßπ???????????????
	FSMC_NORSRAMInitStructure.FSMC_WriteOperation = FSMC_WriteOperation_Enable;	//  ?õ•??ß’???
	FSMC_NORSRAMInitStructure.FSMC_WaitSignal = FSMC_WaitSignal_Disable;        //??????????????????????????
	FSMC_NORSRAMInitStructure.FSMC_ExtendedMode = FSMC_ExtendedMode_Enable; // ?????????????????ß’??®∞???????
	FSMC_NORSRAMInitStructure.FSMC_WriteBurst = FSMC_WriteBurst_Disable;    //????????ß’???????????????????
	FSMC_NORSRAMInitStructure.FSMC_ReadWriteTimingStruct = &readWriteTiming; //??ß’???
	FSMC_NORSRAMInitStructure.FSMC_WriteTimingStruct = &writeTiming;         //ß’???
	FSMC_NORSRAMInit(&FSMC_NORSRAMInitStructure);  //?????FSMC????

	FSMC_NORSRAMCmd(FSMC_Bank1_NORSRAM4, ENABLE);  // ???BANK1???4??
		
 	delay_ms(50); // delay 50 ms 
	
	//????9341 ID????		
	LCD_WR_REG(0XD3);				   
	lcddev.id = LCD_RD_DATA();	//dummy read 	
	lcddev.id = LCD_RD_DATA();	//????0X00
	lcddev.id = LCD_RD_DATA();  //???0X93								   
	lcddev.id <<= 8;
	lcddev.id |= LCD_RD_DATA(); //???0X41 	   			   
	if(lcddev.id != 0X9341)		//??9341,?????????7789
	{
        LCD_WR_REG(0X04);
        lcddev.id = LCD_RD_DATA();      //dummy read
        lcddev.id = LCD_RD_DATA();      //????0X85
        lcddev.id = LCD_RD_DATA();      //???0X85
        lcddev.id <<= 8;
        lcddev.id |= LCD_RD_DATA();     //???0X52

        if (lcddev.id == 0X8552)        //??8552??ID?????7789
        {
            lcddev.id = 0x7789;
        }

        if (lcddev.id != 0x7789)        //?????ST7789, ????????? 5310
        {
            LCD_WR_REG(0XD4);				   
            lcddev.id = LCD_RD_DATA();  //dummy read  
            lcddev.id = LCD_RD_DATA();  //????0X10	 
            lcddev.id = LCD_RD_DATA();  //????0X53	
            lcddev.id <<= 8;	 
            lcddev.id |= LCD_RD_DATA();	//???????0X10	 
            if(lcddev.id != 0X5310)		//?????NT35310,????????????NT35510
            {
                //???????????????,??????
                LCD_WriteReg(0xF000, 0x0055);
                LCD_WriteReg(0xF001, 0x00AA);
                LCD_WriteReg(0xF002, 0x0052);
                LCD_WriteReg(0xF003, 0x0008);
                LCD_WriteReg(0xF004, 0x0001);

                LCD_WR_REG(0xC500);             //???ID??8¶À
                lcddev.id = LCD_RD_DATA();      //????0X55
                lcddev.id <<= 8;

                LCD_WR_REG(0xC501);             //???ID??8¶À
                lcddev.id |= LCD_RD_DATA();     //????0X10
                delay_ms(5);                    //????1963????
                if(lcddev.id==0x8000)lcddev.id=0x5510;//NT35510?????ID??8000H,?????????,????????????5510
                if(lcddev.id!=0X5510)			//?????NT5510,????????????SSD1963
                {
                    LCD_WR_REG(0XA1);
                    lcddev.id = LCD_RD_DATA();
                    lcddev.id = LCD_RD_DATA();  //????0X57
                    lcddev.id <<= 8;
                    lcddev.id |= LCD_RD_DATA(); //????0X61

                    if (lcddev.id == 0X5761)lcddev.id = 0X1963; //SSD1963?????ID??5761H,?????????,????????????1963
				}
			}
		}
	} 
	
	if(lcddev.id==0X9341 || lcddev.id==0X7789 || lcddev.id==0X5310 || lcddev.id==0X5510 || lcddev.id==0X1963)//?????????IC,??????WR???????
	{
		//????????ß’???????????????   	 							    
		FSMC_Bank1E->BWTR[6]&=~(0XF<<0);//??????????(ADDSET)???? 	 
		FSMC_Bank1E->BWTR[6]&=~(0XF<<8);//??????????????
		FSMC_Bank1E->BWTR[6]|=3<<0;		//??????????(ADDSET)?3??HCLK =18ns  	 
        if(lcddev.id == 0X7789)
        {
            FSMC_Bank1E->BWTR[6]|=3<<8; 	//??????????(DATAST)?6ns*3??HCLK=18ns
        }
        else
        {
            FSMC_Bank1E->BWTR[6]|=2<<8; 	//??????????(DATAST)?6ns*2+1??HCLK=18ns
        }
	}
 	printf(" LCD ID:%x\r\n",lcddev.id); //??????LCD ID
	if(lcddev.id == 0X9341)	         
	{	 
		lcd_ex_ili9341_reginit();	 //9341?????
	}
    else if(lcddev.id == 0x7789)      
    {
         lcd_ex_st7789_reginit();   //7789?????
    }
    else if (lcddev.id == 0x5310)
    {
       lcd_ex_5310_reginit();       //5310?????
	}
	else if(lcddev.id == 0x5510)
	{
		lcd_ex_5510_reginit();      //5510?????
	}
	else if(lcddev.id==0X1963)
	{
		lcd_ex_1963_reginit();     //1963?????
	}
    
	LCD_Display_Dir(0);		//????LCD???????0,??????1,????
	GPIO_SetBits(GPIOB, GPIO_Pin_15);   //????LCD????
	LCD_Clear(WHITE);
}  
//????????
//color:???????????
void LCD_Clear(u16 color)
{
    u32 index = 0;
    u32 totalpoint = lcddev.width;
    totalpoint *= lcddev.height;      //????????????

    LCD_SetCursor(0x0000, 0x0000);    //???®¥?????¶À??
    LCD_WriteRAM_Prepare();           //????ß’??GRAM???????ß’GRAM

    for(index = 0; index < totalpoint; index++)
    {
        LCD->LCD_RAM=color;           //???ß’??GRAM
    }
}

//????????????????????
//?????ß≥:(xend-xsta+1)*(yend-ysta+1)
//sx:x?????????sy:y?????????ex:x???????ey:y???????
//color:????????
void LCD_Fill(u16 sx, u16 sy, u16 ex, u16 ey, u16 color)
{
    u16 i, j;
    u16 xlen = 0;

    xlen = ex - sx + 1;             //?????????????????

    for (i = sy; i <= ey; i++)      //??????????????????
    {
        LCD_SetCursor(sx, i);       //???®¥??¶À??
        LCD_WriteRAM_Prepare();     //????ß’??GRAM???????ß’GRAM
        for (j = 0; j < xlen; j++)  //????????????????????????
        {
            LCD->LCD_RAM = color;   //ß’GRAM
        }
    }
}

//??????????????????????
//(sx,sy),(ex,ey):?????¶∆??????,?????ß≥?:(ex-sx+1)*(ey-sy+1)
//color:????????
void LCD_Color_Fill(u16 sx, u16 sy, u16 ex, u16 ey, u16 *color)
{
    u16 height, width;
    u16 i, j;
    width = ex - sx + 1;            //??????????
    height = ey - sy + 1;           //???

    for (i = 0; i < height; i++)
    {
        LCD_SetCursor(sx, sy + i);  //???®¥??¶À??
        LCD_WriteRAM_Prepare();     //????ß’??GRAM???????ß’GRAM

        for (j = 0; j < width; j++)
        {
            LCD->LCD_RAM = color[i * width + j];  //ß’??????
        }
    }
}

//????
//x1,y1:???????
//x2,y2:???????  
void LCD_DrawLine(u16 x1, u16 y1, u16 x2, u16 y2)
{
    u16 t;
    int xerr = 0, yerr = 0, delta_x, delta_y, distance;
    int incx, incy, uRow, uCol;
    delta_x = x2 - x1;              //????????????
    delta_y = y2 - y1;
    uRow = x1;
    uCol = y1;

    if (delta_x > 0)incx = 1;       //???????????
    else if (delta_x == 0)incx = 0; //?????
    else
    {
        incx = -1;
        delta_x = -delta_x;
    }

    if (delta_y > 0)incy = 1;
    else if (delta_y == 0)incy = 0; //????
    else
    {
        incy = -1;
        delta_y = -delta_y;
    }

    if ( delta_x > delta_y)distance = delta_x; //????????????????
    else distance = delta_y;

    for (t = 0; t <= distance + 1; t++ )    //???????
    {
        LCD_DrawPoint(uRow, uCol); //????
        xerr += delta_x ;
        yerr += delta_y ;

        if (xerr > distance)
        {
            xerr -= distance;
            uRow += incx;
        }

        if (yerr > distance)
        {
            yerr -= distance;
            uCol += incy;
        }
    }
}

//??????
//(x1,y1),(x2,y2):???¶≈???????
void LCD_DrawRectangle(u16 x1, u16 y1, u16 x2, u16 y2)
{
	LCD_DrawLine(x1,y1,x2,y1);
	LCD_DrawLine(x1,y1,x1,y2);
	LCD_DrawLine(x1,y2,x2,y2);
	LCD_DrawLine(x2,y1,x2,y2);
}
//?????¶À???????????ß≥???
//(x,y):?????
//r    :??
void LCD_Draw_Circle(u16 x0,u16 y0,u8 r)
{
    int a, b;
    int di;
    a = 0;
    b = r;
    di = 3 - (r << 1);       //?ßÿ??????¶À?????

    while (a <= b)
    {
        LCD_DrawPoint(x0 + a, y0 - b);        //5
        LCD_DrawPoint(x0 + b, y0 - a);        //0
        LCD_DrawPoint(x0 + b, y0 + a);        //4
        LCD_DrawPoint(x0 + a, y0 + b);        //6
        LCD_DrawPoint(x0 - a, y0 + b);        //1
        LCD_DrawPoint(x0 - b, y0 + a);
        LCD_DrawPoint(x0 - a, y0 - b);        //2
        LCD_DrawPoint(x0 - b, y0 - a);        //7
        a++;

        //???Bresenham?????
        if (di < 0)di += 4 * a + 6;
        else
        {
            di += 10 + 4 * (a - b);
            b--;
        }
    }
}


//?????¶À???????????
//x,y:???????
//num:?????????:" "--->"~"
//size:?????ß≥ 12/16/24
//mode:??????(1)??????????(0)
void LCD_ShowChar(u16 x,u16 y,u8 num,u8 size,u8 mode)
{  							  
    u8 temp,t1,t;
	u16 y0 = y;
	u8 csize = (size/8+((size%8) ? 1:0))*(size/2);		//??????????????????????????????	
 	num = num - ' ';                                    //???????????ASCII?????????????????-' '??????????????
	for(t=0;t<csize;t++)
	{   
		if(size == 12)
            temp = asc2_1206[num][t];   //????1206????,?????????????t??????????temp
		else if(size == 16)
            temp = asc2_1608[num][t];	//????1608????,?????????????t??????????temp
		else if(size == 24)
            temp = asc2_2412[num][t];	//????2412????,?????????????t??????????temp
		else return;					//??ß÷????
		for(t1=0;t1<8;t1++)
		{			    
			if(temp & 0x80)
                LCD_Fast_DrawPoint(x,y,POINT_COLOR);   //??????????????????????????
			else if(mode == 0)
                LCD_Fast_DrawPoint(x,y,BACK_COLOR);    //???????????????????????
			temp <<= 1;
			y++;
			if(y >= lcddev.height)
                return;		          //??LCD??????????
			if((y-y0) == size)
			{
				y = y0;
				x++;
				if(x >= lcddev.width)
                    return;	         //??LCD???????????
				break;
			}
		}  	 
	}  	    	   	 	  
}

/******************************************************************************
      ???????????????????
      ????????x,y???????
                num ?????????
                fc ??????
                bc ???????
                sizey ???
                mode:  0???????  1??????
      ???????  ??
******************************************************************************/
void LCD_Show_Char(u16 x,u16 y,u8 num,u16 fc,u16 bc,u8 sizey,u8 mode)
{
	u8 temp,t1,t;
	u16 y0 = y;
	u8 csize = (sizey/8+((sizey%8) ? 1:0))*(sizey/2);		//??????????????????????????????	
 	num = num - ' ';                                    //???????????ASCII?????????????????-' '??????????????
	for(t=0;t<csize;t++)
	{   
		if(sizey == 12)
            temp = asc2_1206[num][t];   //????1206????,?????????????t??????????temp
		else if(sizey == 16)
            temp = asc2_1608[num][t];	//????1608????,?????????????t??????????temp
		else if(sizey == 24)
            temp = asc2_2412[num][t];	//????2412????,?????????????t??????????temp
		else return;					//??ß÷????
		for(t1=0;t1<8;t1++)
		{			    
			if(temp & 0x80)
                LCD_Fast_DrawPoint(x,y,fc);   //??????????????????????????
			else if(mode == 0)
                LCD_Fast_DrawPoint(x,y,bc);    //???????????????????????
			temp <<= 1;
			y++;
			if(y >= lcddev.height)
                return;		          //??LCD??????????
			if((y-y0) == sizey)
			{
				y = y0;
				x++;
				if(x >= lcddev.width)
                    return;	         //??LCD???????????
				break;
			}
		}  	 
	}   	 	  
}

//m^n????
//?????:m^n?¶«?.
u32 LCD_Pow(u8 m,u8 n)
{
	u32 result=1;	 
	while(n--)result*=m;    
	return result;
}			 
//???????,??¶À?0,?????
//x,y :???????	 
//len :?????¶À??
//size:?????ß≥
//color:???
//num:???(0~4294967295);
void LCD_ShowNum(u16 x, u16 y, u32 num, u8 len, u8 size)
{
    u8 t, temp;
    u8 enshow = 0;

    for (t = 0; t < len; t++)
    {
        temp = (num / LCD_Pow(10, len - t - 1)) % 10;

        if (enshow == 0 && t < (len - 1))
        {
            if (temp == 0)
            {
                LCD_ShowChar(x + (size / 2)*t, y, ' ', size, 0);
                continue;
            }
            else enshow = 1;

        }

        LCD_ShowChar(x + (size / 2)*t, y, temp + '0', size, 0);
    }
}

//???????,??¶À?0,???????
//x,y:???????
//num:???(0~999999999);	 
//len:????(????????¶À??)
//size:?????ß≥
//mode:
//[7]:0,?????;1,???0.
//[6:1]:????
//[0]:0,????????;1,???????.
void LCD_ShowxNum(u16 x, u16 y, u32 num, u8 len, u8 size, u8 mode)
{
    u8 t, temp;
    u8 enshow = 0;

    for (t = 0; t < len; t++)
    {
        temp = (num / LCD_Pow(10, len - t - 1)) % 10;

        if (enshow == 0 && t < (len - 1))
        {
            if (temp == 0)
            {
                if (mode & 0X80)LCD_ShowChar(x + (size / 2)*t, y, '0', size, mode & 0X01);
                else LCD_ShowChar(x + (size / 2)*t, y, ' ', size, mode & 0X01);

                continue;
            }
            else enshow = 1;

        }

        LCD_ShowChar(x + (size / 2)*t, y, temp + '0', size, mode & 0X01);
    }
}

//????????
//x,y:???????
//width,height:?????ß≥
//size:?????ß≥
//*p:???????????
void LCD_ShowString(u16 x, u16 y, u16 width, u16 height, u8 size, u8 *p)
{
    u8 x0 = x;
    width += x;
    height += y;

    while ((*p <= '~') && (*p >= ' '))   //?ßÿ???????????!
    {
        if(x >= width)
        {
            x = x0;           //x?????????
            y += size;        //y??????
        }
        if(y >= height)
            break; //???

        LCD_ShowChar(x, y, *p, size, 0);
        x += size / 2;
        p++;
    }  
}

/******************************************************************************
      ?????????????????
      ????????x,y???????
                width,height:????????ß≥
                *s ??????????
                fc ??????
                bc ???????
                sizey ??? ??? 16 24 32
                mode:  0???????  1??????
      ???????  ??
******************************************************************************/
void LCD_ShowChinese(u16 x,u16 y,u16 width, u16 height,u8 *s,u16 fc,u16 bc,u8 sizey,u8 mode)
{
    u8 x0 = x;
    width += x;
    height += y;
	while(*s!=0)
	{
		if(sizey==12) LCD_ShowChinese12x12(x,y,s,fc,bc,sizey,mode);
		else if(sizey==16) LCD_ShowChinese16x16(x,y,s,fc,bc,sizey,mode);
		else if(sizey==24) LCD_ShowChinese24x24(x,y,s,fc,bc,sizey,mode);
		else if(sizey==32) LCD_ShowChinese32x32(x,y,s,fc,bc,sizey,mode);
		else return;
		s += 2;
		x += sizey;
        if(x >= width)
        {
            x = x0;           //x?????????
            y += sizey;       //y??????
        }
        if(y >= height)
            break;            //???
	}
}

/******************************************************************************
      ????????????????12x12????
      ????????x,y???????
                *s ?????????
                fc ??????
                bc ???????
                sizey ???
                mode:  0???????  1??????
      ???????  ??
******************************************************************************/
void LCD_ShowChinese12x12(u16 x,u16 y,u8 *s,u16 fc,u16 bc,u8 sizey,u8 mode)
{
	u8 i,j;
	u16 k;
	u16 HZnum;//???????
	u16 TypefaceNum;
	u16 x0=x;
	TypefaceNum=(sizey/8+((sizey%8)?1:0))*sizey;   //??????????????ß≥
	                         
	HZnum=sizeof(tfont12)/sizeof(typFNT_GB12);	//?????????
	for(k=0;k<HZnum;k++) 
	{
		if((tfont12[k].Index[0]==*(s)) && (tfont12[k].Index[1]==*(s+1)))
		{ 	
			//LCD_Address_Set(x,y,x+sizey-1,y+sizey-1);
			for(i=0;i<TypefaceNum;i++)
			{
				for(j=0;j<8;j++)
				{	
					if(!mode)//???????
					{
						if(tfont12[k].Msk[i]&(0x01<<j))   //????????¶À?????¶À??????ßÿ??¶À???????ßÿ??¶À????(FEH=11111110B)
                            LCD_Fast_DrawPoint(x,y,fc);   //??????????
						else 
                            LCD_Fast_DrawPoint(x,y,bc);   //???????????
						x++;
						if((x-x0)==sizey)
						{
							x=x0;
							y++;
							break;
						}
					}
					else//??????
					{
						if(tfont12[k].Msk[i]&(0x01<<j))	
                            LCD_Fast_DrawPoint(x,y,fc);//???????       
						x++;
						if((x-x0)==sizey)
						{
							x=x0;
							y++;
							break;
						}
					}
				}
			}
            break;    //??????????????????????????????????????????????
		}				  	
	//	continue;  
	}
}

/******************************************************************************
      ????????????????16x16????
      ????????x,y???????
                *s ?????????
                fc ??????
                bc ???????
                sizey ???
                mode:  0???????  1??????
      ???????  ??
******************************************************************************/
void LCD_ShowChinese16x16(u16 x,u16 y,u8 *s,u16 fc,u16 bc,u8 sizey,u8 mode)
{
	u8 i,j;
	u16 k;
	u16 HZnum;//???????
	u16 TypefaceNum;//??????????????ß≥
	u16 x0=x;
    TypefaceNum=(sizey/8+((sizey%8)?1:0))*sizey; //??????????????ß≥
	HZnum=sizeof(tfont16)/sizeof(typFNT_GB16);	//?????????
	for(k=0;k<HZnum;k++) 
	{
		if ((tfont16[k].Index[0]==*(s))&&(tfont16[k].Index[1]==*(s+1)))
		{ 	
			//LCD_Address_Set(x,y,x+sizey-1,y+sizey-1);
			for(i=0;i<TypefaceNum;i++)
			{
				for(j=0;j<8;j++)
				{	
					if(!mode)//???????
					{
						if(tfont16[k].Msk[i]&(0x01<<j))
                            LCD_Fast_DrawPoint(x,y,fc);   //??????????
						else 
                            LCD_Fast_DrawPoint(x,y,bc);   //???????????
						x++;
						if((x-x0)==sizey)
						{
							x=x0;
							y++;
							break;
						}
					}
					else//??????
					{
						if(tfont16[k].Msk[i]&(0x01<<j))	
                            LCD_Fast_DrawPoint(x,y,fc);//???????
						x++;
						if((x-x0)==sizey)
						{
							x=x0;
							y++;
							break;
						}
					}
				}
			}
            break;    //??????????????????????????????????????????????
		}				  	
	//	continue;  
	}
} 


/******************************************************************************
      ????????????????24x24????
      ????????x,y???????
                *s ?????????
                fc ??????
                bc ???????
                sizey ???
                mode:  0???????  1??????
      ???????  ??
******************************************************************************/
void LCD_ShowChinese24x24(u16 x,u16 y,u8 *s,u16 fc,u16 bc,u8 sizey,u8 mode)
{
	u8 i,j;
	u16 k;
	u16 HZnum;//???????
	u16 TypefaceNum;//??????????????ß≥
	u16 x0=x;
    TypefaceNum=(sizey/8+((sizey%8)?1:0))*sizey; //??????????????ß≥
	HZnum=sizeof(tfont24)/sizeof(typFNT_GB24);	//?????????
	for(k=0;k<HZnum;k++) 
	{
		if ((tfont24[k].Index[0]==*(s))&&(tfont24[k].Index[1]==*(s+1)))
		{ 	
			//LCD_Address_Set(x,y,x+sizey-1,y+sizey-1);
			for(i=0;i<TypefaceNum;i++)
			{
				for(j=0;j<8;j++)
				{	
					if(!mode)//???????
					{
						if(tfont24[k].Msk[i]&(0x01<<j))
                            LCD_Fast_DrawPoint(x,y,fc);   //??????????
						else 
                            LCD_Fast_DrawPoint(x,y,bc);   //???????????
						x++;
						if((x-x0)==sizey)
						{
							x=x0;
							y++;
							break;
						}
					}
					else//??????
					{
						if(tfont24[k].Msk[i]&(0x01<<j))	
                            LCD_Fast_DrawPoint(x,y,fc);//???????
						x++;
						if((x-x0)==sizey)
						{
							x=x0;
							y++;
							break;
						}
					}
				}
			}
            break;    //??????????????????????????????????????????????
		}				  	
	//	continue;  
	}
} 

/******************************************************************************
      ????????????????32x32????
      ????????x,y???????
                *s ?????????
                fc ??????
                bc ???????
                sizey ???
                mode:  0???????  1??????
      ???????  ??
******************************************************************************/
void LCD_ShowChinese32x32(u16 x,u16 y,u8 *s,u16 fc,u16 bc,u8 sizey,u8 mode)
{
	u8 i,j;
	u16 k;
	u16 HZnum;//???????
	u16 TypefaceNum;//??????????????ß≥
	u16 x0=x;
    TypefaceNum=(sizey/8+((sizey%8)?1:0))*sizey; //??????????????ß≥
	HZnum=sizeof(tfont32)/sizeof(typFNT_GB32);	//?????????
	for(k=0;k<HZnum;k++) 
	{
		if ((tfont32[k].Index[0]==*(s))&&(tfont32[k].Index[1]==*(s+1)))
		{ 	
			//LCD_Address_Set(x,y,x+sizey-1,y+sizey-1);
			for(i=0;i<TypefaceNum;i++)
			{
				for(j=0;j<8;j++)
				{	
					if(!mode)//???????
					{
						if(tfont32[k].Msk[i]&(0x01<<j))
                            LCD_Fast_DrawPoint(x,y,fc);   //??????????
						else 
                            LCD_Fast_DrawPoint(x,y,bc);   //???????????
						x++;
						if((x-x0)==sizey)
						{
							x=x0;
							y++;
							break;
						}
					}
					else//??????
					{
						if(tfont32[k].Msk[i]&(0x01<<j))	
                            LCD_Fast_DrawPoint(x,y,fc);//???????
						x++;
						if((x-x0)==sizey)
						{
							x=x0;
							y++;
							break;
						}
					}
				}
			}
            break;    //??????????????????????????????????????????????
		}				  	
	//	continue;  
	}
}

/******************************************************************************
      ????????????????????,????????????
      ???????? x,y :???????
                fc:?????????
                bc:???????
                str :?????	 
                sizey:?????ß≥
                mode:??	0,?????;1,??????
      ???????  ??
******************************************************************************/  	   		   
void Show_Str(u16 x, u16 y,u8 *str,u16 fc, u16 bc,u8 sizey,u8 mode)
{					
	u16 x0=x;							  	  
    u8 bHz=0;     //bHz=0???????????bHz=1??????? 
	while(*str!=0)//????¶ƒ????
	{ 
		if(!bHz)   // bHz=0?????????
		{
			if(x>(lcddev.width-sizey/2)||y>(lcddev.height-sizey))  //??????????
                return; 
			if(*str > 0x80)   //0x80=128?????????ascii???????????????????
                bHz=1;        //???? 
			else              //??????
			{          
				if(*str==0x0D)//???ßŸ???
				{
					y+=sizey;
					x=x0;
					str++; 
				}
                else
				{
					LCD_Show_Char(x,y,*str,fc,bc,sizey,mode);     //????????????
					x += sizey/2;                                 //???,???????? 
				} 
			  str++; 
			}
		}
        else    //???? 
		{   
			if(x>(lcddev.width-sizey)||y>(lcddev.height-sizey))   //??????????
                return;  
			bHz=0;          //?????????????????????    
			if(sizey==32)
				LCD_ShowChinese32x32(x,y,str,fc,bc,sizey,mode);	 	
			else if(sizey==24)
				LCD_ShowChinese24x24(x,y,str,fc,bc,sizey,mode);	
			else if(sizey==16)
			  LCD_ShowChinese16x16(x,y,str,fc,bc,sizey,mode);
			else 
			  LCD_ShowChinese12x12(x,y,str,fc,bc,sizey,mode);
			
				str+=2; 
				x += sizey;//????????????	    
			}						 
	}   
}

/******************************************************************************
      ??????????????
      ????????x,y???????
                height ?????
                width  ??????
                pic[]  ??????    
      ???????  ??
******************************************************************************/
void LCD_ShowPicture(u16 x,u16 y,u16 width,u16 height,const u8 pic[])
{
	u8 picH,picL;
	u16 i,j;
	u32 k=0;
	LCD_Address_Set(x,y,x+width-1,y+height-1);       //??????????????????????????
    //LCD_SetCursor(x,y);
	for(i=0;i<width;i++)
	{
		for(j=0;j<height;j++)
		{
			picH=pic[k*2];
			picL=pic[k*2+1];
			LCD_WR_DATA(picH<<8 | picL);
			k++;
		}
	}
    LCD_Address_Set(x,y,lcddev.width,lcddev.height);     //??????????????????????????????????320*480???????????????
}

/******************************************************************************
      ??????????????1
      ????????x,y???????
                height ?????
                width  ??????    
      ???????  ??
******************************************************************************/
void Pic1_test(u16 x,u16 y,u16 width,u16 height)
{
     LCD_ShowPicture(x,y,width,height,gImage_1);
}

/******************************************************************************
      ??????????????2
      ????????x,y???????
                height ?????
                width  ??????    
      ???????  ??
******************************************************************************/
void Pic2_test(u16 x,u16 y,u16 width,u16 height)
{
     LCD_ShowPicture(x,y,width,height,gImage_333);
}
























/* ============================================================
 * ????????????? - ????????????????????
 * ============================================================ */
#include "pic_new.h"

/******************************************************************************
      ???????????????????
      ????????x,y???????
                width  ??????  
                height ?????     
      ???????  ??
******************************************************************************/
void Show_AlarmIcon(u16 x, u16 y, u16 width, u16 height)
{
    LCD_ShowPicture(x, y, width, height, gImage_alarm);
}

/******************************************************************************
      ???????????????? (???????)
      ????????x,y???????
                width  ??????  
                height ?????
                frame_num ???? (0-3)     
      ???????  ??
******************************************************************************/
void Show_VideoFrame(u16 x, u16 y, u16 width, u16 height, u8 frame_num)
{
    switch(frame_num)
    {
        case 0: LCD_ShowPicture(x, y, width, height, gImage_frame1); break;
        case 1: LCD_ShowPicture(x, y, width, height, gImage_frame2); break;
        case 2: LCD_ShowPicture(x, y, width, height, gImage_frame3); break;
        case 3: LCD_ShowPicture(x, y, width, height, gImage_frame4); break;
        default: break;
    }
}
