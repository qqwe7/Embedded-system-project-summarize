# 嵌入式系统课程设计 - 基于STM32F407的RTC闹钟设计

## 项目简介

本项目是《嵌入式系统与设计》课程的期末大作业，基于正点原子STM32F407探索者开发板，实现了一个具有实时时钟显示、双闹钟设置、蜂鸣器提醒、视频循环播放及液晶显示界面的系统。

---

## 功能列表

### 1. 基本信息显示
- 屏幕显示"嵌入式系统课程设计"标题
- 显示学生个人信息（可通过main.c顶部宏定义修改）

### 2. 实时时钟 (RTC)
- 显示当前时间：时:分:秒
- 显示当前日期：年-月-日
- 显示当前星期

### 3. 闹钟功能
- **双闹钟支持**：支持闹钟A和闹钟B
- **闹钟设置**：可以通过串口USMART组件调用 `set_alarm1` 和 `set_alarm2` 进行设置
- **闹钟响应**：
  - 闹钟触发时，显示 R.png 闹钟图标
  - 屏幕显示"闹钟A/B响铃!"提示
  - 蜂鸣器鸣叫提醒（时长可通过 `BEEP_DURATION` 宏配置）

### 4. 视频循环播放
- 使用 1.jpg, 2.jpg, 3.jpg, 4.jpg 四张图片实现循环动画效果
- 帧切换间隔可通过 `VIDEO_FRAME_INTERVAL` 宏配置

### 5. 按键交互
| 按键 | 功能 |
|------|------|
| KEY0 (长按) | 进入时间设置模式 |
| KEY1 | 小时+1 |
| KEY2 | 分钟+1 |
| WK_UP | 确认修改 |
| 任意键 | 停止闹钟 |

---

## 硬件连接说明

### 开发板信息
- **开发板型号**: 正点原子 STM32F407 探索者开发板 V3
- **主控芯片**: STM32F407ZGT6
- **晶振频率**: 8MHz外部晶振，168MHz系统主频

### 接口连接

| 模块 | 引脚 | 说明 |
|------|------|------|
| **串口1 (调试)** | PA9(TX), PA10(RX) | USB转串口，连接ST-Link的VCP |
| **LCD屏幕** | FSMC接口 | 板载3.5寸TFT LCD |
| **蜂鸣器** | PF8 | 有源蜂鸣器，高电平响 |
| **LED0** | PF9 | 低电平亮 |
| **LED1** | PF10 | 低电平亮 |
| **按键KEY0** | PE4 | 低电平有效 |
| **按键KEY1** | PE3 | 低电平有效 |
| **按键KEY2** | PE2 | 低电平有效 |
| **按键WK_UP** | PA0 | 高电平有效 |

### 硬件准备
1. STM32F407探索者开发板 x1
2. USB线（Type-A to Mini-B）x1
3. ST-Link调试器（板载集成）

---

## 开发环境

### 软件要求
- **IDE**: Keil MDK-ARM V5.x
- **编译器**: ARM Compiler 5 或 6
- **下载工具**: ST-Link Utility 或 Keil内置下载
- **串口工具**: XCOM / SSCOM / Tera Term / PuTTY

### 编译步骤
1. 使用Keil打开 `USER/RTC.uvprojx` 工程文件
2. 点击菜单 Project -> Build Target (或按F7)
3. 确认编译结果：0 Error(s), 0 Warning(s)
4. 点击 Flash -> Download 下载程序到开发板

---

## 串口调试使用说明

### 串口配置参数
| 参数 | 值 |
|------|-----|
| 波特率 | 115200 |
| 数据位 | 8 |
| 停止位 | 1 |
| 校验位 | 无 |
| 流控制 | 无 |

### 调试信息说明

程序启动后，串口会输出以下调试信息：

```
==========================================
 RTC Alarm System - STM32F407
 Build: Dec 31 2025 22:00:00
==========================================
[INIT] LED initialized
[INIT] LCD initialized (480x320)
[INIT] KEY initialized
[INIT] BEEP initialized  
[INIT] RTC initialized
[RTC ] Current: 2025-12-31 22:00:00 Week:3
[INFO] System started! Alarm A/B can be set via USMART.
==========================================
```

### 运行时调试信息
- `[KEY ]` - 按键事件
- `[RTC ]` - RTC时间信息
- `[ALARM]` - 闹钟触发/清除信息
- `[BEEP]` - 蜂鸣器状态
- `[DEBUG]` - 周期性状态信息

### USMART调试命令

通过串口发送以下命令控制系统：

| 命令 | 说明 | 示例 |
|------|------|------|
| `list` | 列出可用函数 | - |
| `set_alarm1(week,hour,min)` | 设置闹钟A | `set_alarm1(3,8,30)` 周三8:30 |
| `set_alarm2(week,hour,min)` | 设置闹钟B | `set_alarm2(0,12,0)` 每天12:00 |
| `rtc_set_time(hour,min,sec)` | 设置当前时间 | `rtc_set_time(14,30,0)` |

> **注意**: week参数中 0=每天, 1=周一, 2=周二 ... 7=周日

---

## 用户可配置参数

在 `USER/main.c` 文件顶部可以修改以下参数：

| 参数名 | 说明 | 默认值 |
|--------|------|--------|
| `DEBUG_SERIAL` | 调试输出开关 (1=开启, 0=关闭) | 1 |
| `STUDENT_DEPT` | 院系名称 | 计算机与大数据253Z班 |
| `STUDENT_MAJOR` | 专业名称 | 物联网 |
| `STUDENT_ID` | 学号 | 202502011342 |
| `BEEP_DURATION` | 蜂鸣器响铃时长 (单位10ms) | 300 (3秒) |
| `VIDEO_FRAME_INTERVAL` | 动画帧切换间隔 (单位10ms) | 50 (500ms) |
| `ALARM_ICON_X/Y/W/H` | 闹钟图标位置和尺寸 | 30,200,100,100 |
| `VIDEO_X/Y/W/H` | 动画显示位置和尺寸 | 350,160,100,100 |

---

## 目录结构

```
期末大作业/
├── CORE/           # ARM内核文件
├── FWLIB/          # STM32标准外设库
├── HARDWARE/       # 硬件驱动
│   ├── BEEP/       # 蜂鸣器驱动
│   ├── LCD/        # LCD显示驱动
│   ├── LED/        # LED驱动
│   ├── RTC/        # RTC实时时钟驱动
│   └── key/        # 按键驱动
├── SYSTEM/         # 系统核心
│   ├── delay/      # 延时函数
│   ├── sys/        # 系统配置
│   └── usart/      # 串口驱动
├── USER/           # 用户程序
│   ├── main.c      # 主程序
│   ├── pic.c       # 图片数据
│   └── RTC.uvprojx # Keil工程文件
├── USMART/         # 串口调试组件
├── OBJ/            # 编译输出
└── README.md       # 本文件
```

---

## 常见问题排查

### 1. 编译错误

**问题**: 编译时报"未找到头文件"
**解决**: 检查Keil工程的Include Paths设置，确保包含所有头文件目录

**问题**: 链接错误"L6218E: Undefined symbol"
**解决**: 确认所有源文件已添加到工程

### 2. 烧录问题

**问题**: 无法连接ST-Link
**解决**: 
1. 检查USB连接
2. 安装ST-Link驱动
3. 在Keil Options->Debug中选择正确的调试器

### 3. 串口无输出

**问题**: 串口助手无任何输出
**解决**:
1. 确认波特率设置为115200
2. 检查COM端口号是否正确
3. 确认TX/RX没有接反
4. 检查main.c中是否调用了 `uart_init(115200)`

### 4. LCD不显示

**问题**: LCD白屏或无显示
**解决**:
1. 检查LCD排线连接
2. 确认LCD_Init()函数已调用
3. 查看串口调试信息确认LCD初始化结果

### 5. 闹钟不响

**问题**: 设置闹钟后到时间不触发
**解决**:
1. 通过串口检查闹钟配置信息
2. 确认week参数设置正确（0=每天）
3. 检查RTC时间是否正确同步

---

## 任务完成情况

- [x] LCD显示界面 (标题、个人信息、操作提示)
- [x] RTC时间/日期/星期显示
- [x] 按键调整时间功能
- [x] 闹钟触发逻辑与显示
- [x] 蜂鸣器控制 (3秒自动停/按键手动停)
- [x] 串口调试信息输出
- [x] 项目使用说明书
- [x] 代码注释完善

---

## 版本历史

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.0 | 2025-12-31 | 初始版本，完成所有基本功能 |
| v1.1 | 2025-12-31 | 添加串口调试信息和使用说明书 |

---

## 作者信息

- **课程**: 嵌入式系统与设计
- **院系**: 计算机与大数据253Z班
- **专业**: 物联网
- **学号**: 202502011342
