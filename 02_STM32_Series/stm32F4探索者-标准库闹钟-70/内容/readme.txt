================================================================================
                    STM32F407 综合实验 - 使用说明
================================================================================

【实验名称】
    STM32F407 探索者V3 综合实验
    

【实验平台】
    正点原子 探索者 STM32F407开发板 V3

【实验功能】
    本实验整合了多个功能模块，实现以下功能：

    1. LCD信息显示
       - 显示学院、专业、学号、姓名（全英文）
       - 显示实时日期和时间（24小时制）

    2. RTC实时时钟
       - 格式：2024-12-26 Wed 12:30:45
       - 支持通过USMART串口命令修改时间

    3. 双闹钟功能
       - 闹钟A和闹钟B独立设置
       - 触发时蜂鸣器响3秒 + LCD显示提示

    4. PWM呼吸灯
       - LED0(红灯)亮度渐变效果
       - PWM频率：2KHz

    5. 输入捕获
       - 测量PWM信号高电平时间
       - 精度：1us
       - 结果通过LCD和串口显示

    6. 按键控制
       - KEY0：加快呼吸速度
       - KEY1：减慢呼吸速度

    7. 独立看门狗(IWDG)
       - 超时时间：约1秒
       - TIM3中断每500ms自动喂狗
       - 防止系统死机自动复位

================================================================================

【硬件连接】 ★重要★

    使用前必须用杜邦线连接以下引脚，形成PWM信号闭环：

        PF9 (LED0引脚) ───────> PA0 (WK_UP引脚)

    这样PA0就能捕获到PF9输出的PWM信号。

【引脚分配】

    | 引脚 | 功能        | 说明                        |
    |------|-------------|----------------------------|
    | PF9  | PWM输出     | TIM14_CH1，呼吸灯          |
    | PA0  | 输入捕获    | TIM5_CH1，测量高电平时间    |
    | PF8  | 蜂鸣器      | 闹钟报警                    |
    | PE4  | KEY0        | 按下=快速呼吸               |
    | PE3  | KEY1        | 按下=慢速呼吸               |
    | PA9  | USART1_TX   | 串口发送                    |
    | PA10 | USART1_RX   | 串口接收                    |

================================================================================

【使用步骤】

    第1步：修改用户信息
        打开 User/main.c，找到以下代码并修改：
        
        #define USER_COLLEGE    "College: CST"      // 改为您的学院
        #define USER_MAJOR      "Major: IoT"        // 改为您的专业
        #define USER_ID         "ID: 123456789"     // 改为您的学号
        #define USER_NAME       "Name: Student"     // 改为您的姓名

    第2步：编译下载
        使用Keil MDK打开 Projects/MDK-ARM/atk_f407.uvprojx
        编译并下载到开发板

    第3步：硬件连接
        用杜邦线连接 PF9 -> PA0

    第4步：观察效果
        - LCD显示用户信息和时间
        - LED0呼吸闪烁
        - 串口输出高电平时间

    第5步：功能测试
        - 按KEY0：呼吸加快
        - 按KEY1：呼吸减慢
        - 用串口设置闹钟测试报警

================================================================================

【串口调试】

    波特率：115200
    数据位：8
    停止位：1
    校验位：无

    USMART命令示例（直接在串口发送）：

    1. 设置时间（12:30:45，24小时制）
       rtc_set_time(12,30,45,0)

    2. 设置日期（2024年12月26日，周四）
       rtc_set_date(24,12,26,4)

    3. 设置闹钟A（周一 12:00:00）
       rtc_set_alarma(1,12,0,0)

    4. 设置闹钟B（周二 18:30:00）
       rtc_set_alarmb(2,18,30,0)

================================================================================

【文件结构】

    实验15 RTC实验/
    ├── User/
    │   └── main.c              <- 主程序（已修改）
    ├── Drivers/
    │   ├── BSP/
    │   │   ├── BEEP/           <- 蜂鸣器驱动
    │   │   ├── KEY/            <- 按键驱动
    │   │   ├── LED/            <- LED驱动
    │   │   ├── LCD/            <- LCD驱动
    │   │   ├── RTC/            <- RTC驱动（已修改，添加闹钟B）
    │   │   ├── TIMER/          <- 定时器驱动（PWM/输入捕获）
    │   │   └── WDG/            <- 看门狗驱动
    │   ├── CMSIS/              <- ARM内核文件
    │   └── SYSTEM/             <- 系统文件(delay/usart/sys)
    ├── Middlewares/
    │   └── USMART/             <- 调试组件（已修改）
    ├── Projects/
    │   └── MDK-ARM/            <- Keil工程文件
    └── readme.txt              <- 本文件

================================================================================

【修改记录】

    2024-12-26  V2.0
        - 基于RTC实验工程修改
        - 添加LCD用户信息显示
        - 添加双闹钟功能（A/B）+ 蜂鸣器报警
        - 添加PWM呼吸灯功能（TIM14）
        - 添加输入捕获功能（TIM5）
        - 添加按键控制呼吸速度
        - 添加USMART闹钟设置命令
        - 添加独立看门狗(IWDG)，TIM3中断喂狗

================================================================================

【常见问题】

    Q: 编译报错"Undefined symbol"？
    A: 确保以下文件已添加到Keil工程：
       beep.c, key.c, wdg.c, gtim.c

    Q: LCD不显示？
    A: 检查LCD排线连接是否正确

    Q: 串口无输出？
    A: 检查CH340驱动是否安装，波特率是否115200

    Q: 输入捕获数据为0？
    A: 检查PF9和PA0是否用杜邦线连接

    Q: 闹钟不触发？
    A: 确保设置的闹钟时间是未来时间，且星期正确

================================================================================
                            正点原子@ALIENTEK
                          www.openedv.com
================================================================================