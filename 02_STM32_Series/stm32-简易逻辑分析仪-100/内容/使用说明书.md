# 简易逻辑分析仪 使用说明书

**版本**: v1.0  
**适用硬件**: GD32F103RCT6 / STM32F103RCT6 开发板  
**日期**: 2026年1月

---

## 目录

1. [产品概述](#1-产品概述)
2. [硬件连接](#2-硬件连接)
3. [固件烧录](#3-固件烧录)
4. [上位机使用](#4-上位机使用)
5. [串口命令](#5-串口命令)
6. [自测功能](#6-自测功能)
7. [常见问题](#7-常见问题)
8. [技术规格](#8-技术规格)

---

## 1. 产品概述

### 功能简介

本项目是基于 GD32F103RCT6 的简易逻辑分析仪，用于采集和分析数字信号时序。

**主要功能**：
- **8通道同时采样** (PA0-PA7)
- **可调采样率** (最高 9MHz)
- **4KB 采样缓冲区**
- **触发功能** (上升沿/下降沿)
- **串口通信** (115200bps)
- **图形化上位机** (无需安装Python)

### 应用场景

- 调试 GPIO 输出信号
- 分析 SPI/I2C/UART 通信时序
- 检测按键、编码器信号
- 数字电路教学

---

## 2. 硬件连接

### 引脚定义

| 功能 | 引脚 | 说明 |
|------|------|------|
| 信号输入 CH0 | PA0 | 数字信号通道0 |
| 信号输入 CH1 | PA1 | 数字信号通道1 |
| 信号输入 CH2 | PA2 | 数字信号通道2 |
| 信号输入 CH3 | PA3 | 数字信号通道3 |
| 信号输入 CH4 | PA4 | 数字信号通道4 |
| 信号输入 CH5 | PA5 | 数字信号通道5 |
| 信号输入 CH6 | PA6 | 数字信号通道6 |
| 信号输入 CH7 | PA7 | 数字信号通道7 |
| 串口TX | PA9 | 连接USB转串口RX |
| 串口RX | PA10 | 连接USB转串口TX |
| 测试信号输出 | PB1 | 1kHz PWM 自测信号 |
| 地线 | GND | 必须共地 |

### 接线图

```
待测信号源               开发板                    PC
    │                      │                      │
    │ 信号线               │ USB转串口            │
    ├──────────► PA0-PA7   ├─────────────────────►│ USB
    │                      │                      │
    │ GND                  │ GND                  │
    └──────────► GND ◄─────┘                      │
```

> ⚠️ **注意**：信号电压必须在 0-3.3V 范围内！

---

## 3. 固件烧录

### 编译环境

- **Keil MDK-ARM v5.x**
- ST-Link V2 调试器

### 步骤

1. 打开 `Project.uvprojx` 工程文件
2. 点击 **Build (F7)** 编译
3. 连接 ST-Link 到 SWD 接口
4. 点击 **Download (F8)** 下载

### 验证

打开串口助手 (115200, 8N1)，复位后应显示：
```
================================
  Simple Logic Analyzer v1.0
  GD32F103RCT6
================================
Type 'HELP' for commands.
```

---

## 4. 上位机使用

### 启动软件

双击运行 `dist/LogicAnalyzer.exe`（无需安装 Python）

### 界面说明

1. **串口连接区** - 选择 COM 口和波特率，点击连接
2. **采样参数区** - 设置采样率、采样数量、触发条件
3. **控制按钮** - 开始采样、获取数据、帮助
4. **波形显示区** - 8通道数字波形，支持缩放滚动
5. **日志区** - 显示通信记录

### 操作流程

1. 选择串口 → 点击 **连接**
2. 设置采样参数（或使用默认值）
3. 连接待测信号到 PA0-PA7
4. 点击 **开始采样**
5. 查看波形显示

### 采样率设置

采样率 = 72MHz ÷ (PSC+1) ÷ (ARR+1)

| PSC | ARR | 采样率 |
|-----|-----|--------|
| 71 | 99 | 10 kHz |
| 71 | 9 | 100 kHz |
| 71 | 0 | 1 MHz |
| 7 | 0 | 9 MHz |

---

## 5. 串口命令

可通过串口助手直接发送命令控制设备：

| 命令 | 说明 | 示例 |
|------|------|------|
| `RATE <psc> <arr>` | 设置采样率 | `RATE 71 9` |
| `COUNT <n>` | 设置采样数量 (≤1024) | `COUNT 512` |
| `TRIG <pin> <edge>` | 设置触发 | `TRIG 0 1` |
| `NOTRIG` | 禁用触发 | `NOTRIG` |
| `CAP` | 开始采样 | `CAP` |
| `STATUS` | 查询状态 | `STATUS` |
| `SEND` | 发送数据 | `SEND` |
| `HELP` | 显示帮助 | `HELP` |

**触发参数**：
- pin: 0-7 (对应 PA0-PA7)
- edge: 0=下降沿, 1=上升沿

---

## 6. 自测功能

程序内置自测信号，**PB1 输出 1kHz 方波**。

### 自测步骤

1. 用杜邦线连接 **PB1 → PA0**
2. 发送 `CAP` 命令
3. 查看数据是否有 `0xFE`/`0xFF` 交替变化

### 预期结果

- 采样率 10kHz 时，每周期约 10 个采样点
- 波形应显示约 50% 高电平、50% 低电平

---

## 7. 常见问题

### Q: 串口无响应
- 检查波特率是否为 115200
- 检查 TX/RX 是否接反
- 按复位键重启

### Q: 全是 0xFF 或 0x00
- 检查信号线连接
- 确认信号源正在输出
- 确认电压在 0-3.3V 范围

### Q: EXE 被杀毒软件拦截
- PyInstaller 打包的程序常被误报
- 添加到杀毒软件白名单即可

### Q: 使用 STM32F103C8T6 测试
- 修改 Keil 工程中的宏定义为 `STM32F10X_MD`
- 更换启动文件为 `startup_stm32f10x_md.s`

---

## 8. 技术规格

| 参数 | 规格 |
|------|------|
| 采样通道 | 8 (PA0-PA7) |
| 输入电压 | 0 - 3.3V |
| 最大采样率 | 9 MHz |
| 采样深度 | 1024 样本 (调试版) |
| 触发类型 | 上升沿 / 下降沿 |
| 通信接口 | UART 115200bps |
| 主控芯片 | GD32F103RCT6 |

---

## 文件结构

```
LogicAnalyzer/
├── Hardware/           # 驱动模块
│   ├── Serial.c/.h          - 串口通信
│   ├── LogicAnalyzer.c/.h   - 采样核心
│   └── CommandParser.c/.h   - 命令解析
├── User/               # 用户代码
│   └── main.c               - 主程序
├── Library/            # 标准外设库
├── Start/              # 启动文件
├── dist/               # 上位机程序
│   └── LogicAnalyzer.exe    - 图形界面
├── viewer.py           # Python源码
├── Project.uvprojx     # Keil工程
└── 使用说明书.md       # 本文档
```

---

*© 2026 简易逻辑分析仪项目*
